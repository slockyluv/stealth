generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ContinentId {
  europe
  asia
  north_america
  south_america
  africa
  oceania
}

model User {
  id        BigInt   @id
  createdAt DateTime @default(now())
}

model Marriage {
  id           BigInt   @id @default(autoincrement())
  guildId      BigInt
  userIdA      BigInt
  userIdB      BigInt
  startedAt    DateTime @default(now())
  daysTogether Int      @default(0)
  updatedAt    DateTime @updatedAt

  @@unique([guildId, userIdA, userIdB])
  @@index([guildId, userIdA])
  @@index([guildId, userIdB])
}

model AutoRole {
  id        BigInt   @id @default(autoincrement())
  guildId   BigInt
  roleId    BigInt
  createdAt DateTime @default(now())

  @@unique([guildId, roleId])
  @@index([guildId])
}

model ActionLogSetting {
  guildId                  BigInt   @id
  moderationChannelId      BigInt?
  moderationUpdatedBy      BigInt?
  rolesChannelId           BigInt?
  rolesUpdatedBy           BigInt?
  messagesChannelId        BigInt?
  messagesUpdatedBy        BigInt?
  trafficChannelId         BigInt?
  trafficUpdatedBy         BigInt?
  economyChannelId         BigInt?
  economyUpdatedBy         BigInt?
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
}


model Mute {
  id          BigInt   @id @default(autoincrement())
  guildId     BigInt
  userId      BigInt
  moderatorId BigInt
  reason      String?
  expiresAt   DateTime
  createdAt   DateTime @default(now())

  @@unique([guildId, userId])
  @@index([guildId, expiresAt])
}

model CountryProfile {
  id              BigInt   @id @default(autoincrement())
  guildId         BigInt
  countryName     String
  ruler           String
  territory       String
  population      String
  ideology        String?
  governmentForm  String?
  stateStructure  String?
  religion        String?
  budget          BigInt   @default(0)
  populationTaxRate Int    @default(10)
  residentCompanyTaxRate Int @default(10)
  foreignCompanyTaxRate Int @default(10)
  lastPopulationTaxAt DateTime?
  registeredUserId BigInt?
  registeredAt    DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([guildId, countryName])
  @@index([guildId])
  @@index([guildId, registeredUserId])
}

model CountryRegistration {
  id          BigInt      @id @default(autoincrement())
  guildId     BigInt
  userId      BigInt
  countryName String
  countryKey  String
  continent   ContinentId
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@unique([guildId, userId])
  @@unique([guildId, countryKey])
  @@index([guildId, continent])
}

model PrivateCompanyDraft {
  id            BigInt      @id @default(autoincrement())
  guildId       BigInt
  userId        BigInt
  name          String?
  industryKey   String?
  industryLabel String?
  countryName   String?
  countryKey    String?
  continent     ContinentId?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@unique([guildId, userId])
  @@index([guildId])
}

model PrivateCompany {
  id            BigInt      @id @default(autoincrement())
  guildId       BigInt
  ownerId       BigInt
  name          String
  industryKey   String
  industryLabel String
  countryName   String
  countryKey    String
  continent     ContinentId
  isActive      Boolean     @default(true)
  budget        BigInt      @default(0)
  branchCount   Int         @default(0)
  paymentSystemLegalNewsStarted Boolean @default(false)
  paymentSystemLegalNewsDone Boolean @default(false)
  paymentSystemInfrastructureMainOfficeBuilt Boolean @default(false)
  paymentSystemInfrastructureServerBuilt Boolean @default(false)
  paymentSystemWebDevelopmentOrdered Boolean @default(false)
  investmentExchangeLegalNewsStarted Boolean @default(false)
  investmentExchangeLegalNewsDone Boolean @default(false)
  investmentExchangeInfrastructureMainOfficeBuilt Boolean @default(false)
  investmentExchangeInfrastructureServerBuilt Boolean @default(false)
  investmentExchangeWebDevelopmentOrdered Boolean @default(false)
  cryptoExchangeLegalNewsStarted Boolean @default(false)
  cryptoExchangeLegalNewsDone Boolean @default(false)
  cryptoExchangeInfrastructureMainOfficeBuilt Boolean @default(false)
  cryptoExchangeInfrastructureServerBuilt Boolean @default(false)
  cryptoExchangeWebDevelopmentOrdered Boolean @default(false)
  constructionLegalNewsStarted Boolean @default(false)
  constructionLegalNewsDone Boolean @default(false)
  constructionEquipmentMainPurchased Boolean @default(false)
  constructionEquipmentSupportPurchased Boolean @default(false)
  constructionWebDevelopmentOrdered Boolean @default(false)
  manufacturingLegalNewsStarted Boolean @default(false)
  manufacturingLegalNewsDone Boolean @default(false)
  manufacturingInfrastructureMainOfficeBuilt Boolean @default(false)
  manufacturingInfrastructureProductionBuilt Boolean @default(false)
  manufacturingEquipmentMainPurchased Boolean @default(false)
  manufacturingEquipmentSupportPurchased Boolean @default(false)
  paymentTransferFeeRate Int?
  investmentTradeFeeRate Int?
  cryptoTradeFeeRate Int?
  cryptoTransferFeeRate Int?
  constructionProfitRate Int?
  manufacturingMarkupRate Int?
  registeredAt  DateTime    @default(now())
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([guildId, countryKey])
  @@index([guildId, ownerId])
}

model CompanyActivityCountry {
  id                   BigInt      @id @default(autoincrement())
  guildId              BigInt
  companyId            BigInt
  companyName          String
  companyIndustryKey   String
  companyIndustryLabel String
  countryName          String
  countryKey           String
  continent            ContinentId
  startedAt            DateTime    @default(now())
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt

  @@unique([guildId, companyId, countryKey])
  @@index([guildId, countryKey])
  @@index([guildId, companyId])
}

model GuildUserLevel {
  guildId          BigInt
  userId           BigInt
  level            Int      @default(0)
  xp               Decimal  @default(0)
  streakDays       Int      @default(0)
  maxStreakDays    Int      @default(0)
  totalMessageCount Int     @default(0)
  totalVoiceMinutes Int     @default(0)
  lastMessageContent String?
  lastMessageAt     DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@id([guildId, userId])
  @@index([guildId])
  @@index([level])
  @@index([maxStreakDays])
  @@index([totalMessageCount])
  @@index([guildId, totalMessageCount])
  @@index([totalVoiceMinutes])
}

model GuildUserDailyStat {
  id            BigInt   @id @default(autoincrement())
  guildId       BigInt
  userId        BigInt
  date          DateTime
  messageCount  Int      @default(0)
  voiceMinutes  Int      @default(0)
  qualified     Boolean  @default(false)
  bonusGranted  Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([guildId, userId, date])
  @@index([guildId, date])
}

model GuildUserVoiceSession {
  guildId       BigInt
  userId        BigInt
  channelId     BigInt
  joinedAt      DateTime
  eligibleSince DateTime?

  @@id([guildId, userId])
  @@index([guildId, channelId])
  @@index([eligibleSince])
}

model GuildMemberDailyStat {
  id          BigInt   @id @default(autoincrement())
  guildId     BigInt
  date        DateTime
  joins       Int      @default(0)
  leaves      Int      @default(0)
  memberCount Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([guildId, date])
  @@index([guildId, date])
}

model PayTransferDraft {
  id                     BigInt   @id @default(autoincrement())
  guildId                BigInt
  userId                 BigInt
  recipientUserId        BigInt?
  amount                 BigInt?
  paymentSystemCompanyId BigInt?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  @@unique([guildId, userId])
  @@index([guildId])
}

model PayTransfer {
  id                     BigInt   @id @default(autoincrement())
  guildId                BigInt
  senderUserId           BigInt
  recipientUserId        BigInt
  senderEntityType       String
  recipientEntityType    String
  senderCompanyId        BigInt?
  recipientCompanyId     BigInt?
  senderCountryKey       String
  recipientCountryKey    String
  amount                 BigInt
  feeRate                Int
  feeAmount              BigInt
  receivedAmount         BigInt
  method                 String
  paymentSystemCompanyId BigInt?
  createdAt              DateTime @default(now())

  @@index([guildId, senderUserId])
  @@index([guildId, recipientUserId])
}